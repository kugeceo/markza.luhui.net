<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>标志自由绘制功能演示 | Markza</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f5f5f5;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }
    
    header {
      background-color: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      margin-bottom: 20px;
    }
    
    h1 {
      color: #333;
      margin: 0;
      font-size: 24px;
    }
    
    .editor-container {
      background-color: white;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      padding: 20px;
    }
    
    .toolbar {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 20px;
      padding-bottom: 20px;
      border-bottom: 1px solid #eee;
    }
    
    .toolbar button {
      padding: 8px 16px;
      border: 1px solid #ddd;
      background-color: white;
      border-radius: 4px;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .toolbar button:hover {
      background-color: #f0f0f0;
    }
    
    .toolbar button.active {
      background-color: #ec4899;
      color: white;
      border-color: #ec4899;
    }
    
    .color-picker {
      width: 40px;
      height: 40px;
      border: 1px solid #ddd;
      border-radius: 4px;
      cursor: pointer;
      padding: 0;
    }
    
    .line-width {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .preview-container {
      width: 100%;
      height: 600px;
      border: 2px dashed #ccc;
      border-radius: 8px;
      position: relative;
      overflow: hidden;
      background-color: #fff;
      background-image: 
        linear-gradient(45deg, #f5f5f5 25%, transparent 25%), 
        linear-gradient(-45deg, #f5f5f5 25%, transparent 25%), 
        linear-gradient(45deg, transparent 75%, #f5f5f5 75%), 
        linear-gradient(-45deg, transparent 75%, #f5f5f5 75%);
      background-size: 20px 20px;
      background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
    }
    
    .export-options {
      margin-top: 20px;
      padding-top: 20px;
      border-top: 1px solid #eee;
    }
    
    .export-buttons {
        display: flex;
        gap: 10px;
        margin-bottom: 15px;
      }
      
      .export-button {
        background-color: #3b82f6;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 4px;
        cursor: pointer;
        font-weight: 500;
        display: flex;
        align-items: center;
        gap: 5px;
      }
      
      .export-button:hover {
        background-color: #2563eb;
      }
      
      .export-button.svg {
          background-color: #10b981;
        }
        
        .export-button.svg:hover {
          background-color: #059669;
        }
        
        .export-button.import {
          background-color: #6366f1;
        }
        
        .export-button.import:hover {
          background-color: #4f46e5;
        }
      
      .download-links {
        display: flex;
        gap: 20px;
      }
      
      /* 成功消息样式 */
      .success-message {
        background-color: #d1fae5;
        color: #065f46;
        padding: 10px 20px;
        border-radius: 4px;
        position: fixed;
        top: 20px;
        right: 20px;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        z-index: 1000;
        animation: slideIn 0.3s ease-out;
      }
      
      @keyframes slideIn {
        from {
          transform: translateX(100%);
          opacity: 0;
        }
        to {
          transform: translateX(0);
          opacity: 1;
        }
      }
    
    .export-preview {
      margin-top: 20px;
      display: none;
    }
    
    .export-preview img {
      max-width: 100%;
      border: 1px solid #eee;
      border-radius: 4px;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>标志自由绘制功能演示</h1>
      <p>使用下方工具栏进行绘制、调整颜色和线宽，在画布上自由创作您的标志</p>
    </header>
    
    <div class="editor-container">
      <div class="toolbar">
        <button id="draw-toggle" class="active">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M12 19l7-7 3 3-7 7-3-3z"></path>
            <path d="M18 13l-1.5-7.5L2 2l3.5 14.5L13 18l5-5z"></path>
            <path d="M2 2l7.586 7.586"></path>
            <circle cx="11" cy="11" r="2"></circle>
          </svg>
          绘制模式
        </button>
        
        <label class="line-width">
          <span>线宽:</span>
          <input type="range" id="line-width" min="1" max="20" value="2">
          <span id="line-width-value">2px</span>
        </label>
        
        <label>
          <span>颜色:</span>
          <input type="color" id="draw-color" class="color-picker" value="#000000">
        </label>
        
        <button id="clear-canvas">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path>
          </svg>
          清除画布
        </button>
        
        <button id="undo-button">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M12 4v6l-4-4"></path>
            <path d="M8 12H4c-1.1 0-2 .9-2 2v8c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2v-8c0-1.1-.9-2-2-2h-8"></path>
          </svg>
          撤销
        </button>
      </div>
      
      <div id="preview-container" class="preview-container">
        <!-- 画布将在这里动态创建 -->
      </div>
      
      <div class="export-options">
        <h3>导出您的标志</h3>
        <div class="export-buttons">
            <button id="export-png-button" class="export-button">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="7 10 12 15 17 10"></polyline>
                <line x1="12" y1="15" x2="12" y2="3"></line>
              </svg>
              导出为PNG图片
            </button>
            <button id="export-svg-button" class="export-button svg">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="7 10 12 15 17 10"></polyline>
                <line x1="12" y1="15" x2="12" y2="3"></line>
              </svg>
              导出为SVG文件
            </button>
            <button id="import-to-main" class="export-button import">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M12 19l7-7 3 3-7 7-3-3z"></path>
                <path d="M18 13l-1.5-7.5L2 2l3.5 14.5L13 18l5-5z"></path>
                <path d="M2 2l7.586 7.586"></path>
                <circle cx="11" cy="11" r="2"></circle>
              </svg>
              导入到主界面
            </button>
          </div>
        
        <div id="export-preview" class="export-preview">
          <h4>导出预览:</h4>
          <img id="export-image" src="" alt="导出的标志">
          <div class="download-links">
            <p><a id="download-png-link" href="" download="markza-logo.png">下载PNG图片</a></p>
            <p><a id="download-svg-link" href="" download="markza-logo.svg">下载SVG文件</a></p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="/assets/js/freeDraw.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // 创建自由绘制实例
      const previewContainer = document.getElementById('preview-container');
      const freeDrawInstance = new FreeDraw('preview-container', {
        lineWidth: 2,
        color: '#000000',
        backgroundColor: 'transparent'
      });
      
      // 绘制模式切换
      const drawToggle = document.getElementById('draw-toggle');
      let isDrawingMode = true;
      
      drawToggle.addEventListener('click', function() {
        isDrawingMode = !isDrawingMode;
        
        if (isDrawingMode) {
          freeDrawInstance.toggleVisibility(true);
          drawToggle.classList.add('active');
          previewContainer.style.cursor = 'crosshair';
        } else {
          freeDrawInstance.toggleVisibility(false);
          drawToggle.classList.remove('active');
          previewContainer.style.cursor = 'default';
        }
      });
      
      // 线宽调整
      const lineWidthInput = document.getElementById('line-width');
      const lineWidthValue = document.getElementById('line-width-value');
      
      lineWidthInput.addEventListener('input', function() {
        const width = parseInt(this.value);
        freeDrawInstance.setLineWidth(width);
        lineWidthValue.textContent = width + 'px';
      });
      
      // 颜色选择
      const colorPicker = document.getElementById('draw-color');
      
      colorPicker.addEventListener('input', function() {
        freeDrawInstance.setColor(this.value);
      });
      
      // 清除画布
      const clearButton = document.getElementById('clear-canvas');
      
      clearButton.addEventListener('click', function() {
        if (confirm('确定要清除当前绘制的内容吗？')) {
          freeDrawInstance.clear();
        }
      });
      
      // 撤销功能
      const undoButton = document.getElementById('undo-button');
      
      undoButton.addEventListener('click', function() {
        freeDrawInstance.undo();
      });
      
      // 导出功能
      const exportPngButton = document.getElementById('export-png-button');
      const exportSvgButton = document.getElementById('export-svg-button');
      const exportPreview = document.getElementById('export-preview');
      const exportImage = document.getElementById('export-image');
      const downloadPngLink = document.getElementById('download-png-link');
      const downloadSvgLink = document.getElementById('download-svg-link');
      
      // PNG导出
      exportPngButton.addEventListener('click', function() {
        // 导出为PNG图片
        const dataURL = freeDrawInstance.exportAsDataURL('image/png');
        
        // 显示预览
        exportImage.src = dataURL;
        downloadPngLink.href = dataURL;
        
        // 为SVG链接创建适当的下载
        const svgUrl = freeDrawInstance.exportAsSVG();
        downloadSvgLink.href = svgUrl;
        
        exportPreview.style.display = 'block';
        
        // 滚动到预览区域
        exportPreview.scrollIntoView({ behavior: 'smooth' });
      });
      
      // SVG导出
      exportSvgButton.addEventListener('click', function() {
        // 直接导出SVG文件而不显示预览
        const svgUrl = freeDrawInstance.exportAsSVG();
        const link = document.createElement('a');
        link.href = svgUrl;
        link.download = 'markza-logo.svg';
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        URL.revokeObjectURL(svgUrl);
      });
      
      // 导入到主界面
      const importToMainButton = document.getElementById('import-to-main');
      
      importToMainButton.addEventListener('click', function() {
        // 获取绘制的图像数据
        const svgUrl = freeDrawInstance.exportAsSVG();
        
        // 存储到localStorage，以便主界面可以访问
        localStorage.setItem('markza-drawn-logo', svgUrl);
        
        // 显示成功消息
        const successMessage = document.createElement('div');
        successMessage.className = 'success-message';
        successMessage.textContent = '标志已成功导入到主界面！请返回主界面查看。';
        document.body.appendChild(successMessage);
        
        // 3秒后移除消息
        setTimeout(function() {
          successMessage.remove();
        }, 3000);
        
        // 如果是在弹窗中打开的，可以尝试关闭弹窗
        if (window.opener) {
          // 通知主窗口有新的图像可用
          window.opener.postMessage({ type: 'MARKZA_LOGO_IMPORTED' }, '*');
          // 可选：关闭当前窗口
          // window.close();
        }
      });
      
      // 窗口大小调整时调整画布
      window.addEventListener('resize', function() {
        // 这里可以添加响应式调整逻辑
      });
    });
  </script>
</body>
</html>